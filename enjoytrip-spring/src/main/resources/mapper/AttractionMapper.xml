<!-- resources/mapper/QnaService/QnaServiceMapper.xml -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoytrip.attraction.model.mapper.AttractionMapper">

    <resultMap type="AttractionDto" id="attraction">
        <result column="content_id" property="contentId"/>
        <result column="content_type_id" property="contentTypeId"/>
        <result column="cat3" property="categoryCode"/>
        <result column="title" property="title"/>
        <result column="addr1" property="addr1"/>
        <result column="latitude" property="latitude"/>
        <result column="longitude" property="longitude"/>
    </resultMap>


    <select id="listAttraction" parameterType="map" resultMap="attraction">
        select i.content_id as content_id, i.content_type_id as content_type_id, d.cat3 as cat3,
               i.title as title, i.addr1 as addr1, i.latitude as latitude, i.longitude as longitude
        from (  select *
                from attraction_info
                where title like concat('%', #{word}, '%') or addr1 like concat('%', #{word}, '%')
              ) i join attraction_detail d
        on i.content_id = d.content_id
        order by i.readcount desc
        limit #{start}, #{listsize}
    </select>

    <select id="getTotalAttractionCount" parameterType="map" resultType="int">
        select count(*)
        from attraction_info
        where title like concat('%', #{word}, '%') or addr1 like concat('%', #{word}, '%')
        limit #{start}, #{listsize}
    </select>

    <select id="getAttraction" parameterType="map" resultMap="attraction">
        select i.content_id as content_id, i.content_type_id as content_type_id, d.cat3 as cat3,
        i.title as title, i.addr1 as addr1, i.latitude as latitude, i.longitude as longitude
        from (  select *
        from attraction_info
        where latitude = #{latitude} and longitude = #{longitude}
        ) i join attraction_detail d
        on i.content_id = d.content_id
    </select>


</mapper>
